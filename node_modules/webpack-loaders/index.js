
function getQueryString(query) {
    return "?" + JSON.stringify(query);
}

function getQueryObject(s){
    s = s.substr(1);
    var o = JSON.parse(s);
    return o;
}

module.exports.macysHandlebarsLoader = function(content){
    if(this.context.indexOf('@feature') > -1) {

        if(this.loaders[this.loaderIndex-1]) {
            var query = this.loaders[this.loaderIndex-1].query;
            var queryObj = getQueryObject(query);
            var contextArr = this.context.split('/');
            var partialsIndex = contextArr.indexOf('partials');
            var newRootRelArr = contextArr.slice(0,partialsIndex+1);
            var rootRel = newRootRelArr.join('/') + '/';
            queryObj.rootRelative = rootRel;
            this.loaders[this.loaderIndex-1].query = getQueryString(queryObj);
        }
    }
    return content;
};